<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CitaResposta</title>
  <style>
    /* Seus estilos CSS aqui */
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: linear-gradient(to right, #f9d423, #ff4e50);
      color: #333;
      text-align: center;
      padding: 40px;
    }
    .container {
      background: #fff;
      border-radius: 20px;
      padding: 30px;
      max-width: 600px;
      margin: 0 auto;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    h1 {
      font-size: 2.5rem;
      color: #e74c3c;
    }
    .subtitle {
      font-size: 1.3rem;
      color: #3498db;
      margin-bottom: 20px;
    }
    .question {
      font-size: 1.3rem;
      margin-bottom: 20px;
    }
    input[type="text"], input[type="email"], input[type="password"] {
      padding: 10px;
      width: 80%;
      border: 2px solid #e74c3c;
      border-radius: 10px;
      font-size: 1rem;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 20px;
      margin: 10px 5px;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      background-color: #e74c3c;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #c0392b;
    }
    .feedback {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.2rem;
    }
    #restartBtn, #giveUpBtn, #noSenseBtn, #secondChanceBtn, #skipBtn {
      display: none;
      background-color: #3498db;
    }
    #skipBtn {
      background-color: #27ae60;
    }
    #hintBtn {
      background-color: #f39c12;
    }
    .hint-text {
      color: #f39c12;
      font-style: italic;
      margin: 10px 0;
    }
    .score {
      margin: 10px 0;
      font-size: 1.1rem;
      color: #e74c3c;
    }
    .player-container {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .player {
      flex: 1;
      border: 2px solid #3498db;
      border-radius: 10px;
      padding: 10px;
      margin: 0 5px;
      background-color: #f8f9fa;
    }
    .active-player {
      border: 2px solid #e74c3c;
      background-color: #fff8e1;
    }
    .player-name {
      font-weight: bold;
      color: #3498db;
      margin-bottom: 5px;
    }
    .player-score {
      color: #e74c3c;
      font-size: 1.1rem;
    }
    #gameModeBtns {
      margin-bottom: 20px;
    }
    #difficultyBtns {
      margin-bottom: 20px;
      display: none;
    }
    .difficulty-btn {
      padding: 10px 20px;
      margin: 5px;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
    }
    #easyBtn {
      background-color: #2ecc71;
      color: white;
    }
    #mediumBtn {
      background-color: #f1c40f;
      color: white;
    }
    #hardBtn {
      background-color: #e74c3c;
      color: white;
    }
    .difficulty-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .difficulty-indicator {
      font-size: 1.2rem;
      font-weight: bold;
      margin: 10px 0;
      padding: 5px 10px;
      border-radius: 5px;
      display: inline-block;
    }
    .easy {
      background-color: #2ecc71;
      color: white;
    }
    .medium {
      background-color: #f1c40f;
      color: white;
    }
    .hard {
      background-color: #e74c3c;
      color: white;
    }
    #duetoSetup, #player2Container {
      display: none;
    }
    .winner {
      color: #27ae60;
      font-size: 1.5rem;
      font-weight: bold;
      margin-top: 20px;
    }
    #timer {
      font-size: 1.2rem;
      color: #e67e22;
      margin: 10px 0;
    }
    #networkStatus {
      font-size: 0.9rem;
      color: #7f8c8d;
      margin-top: 15px;
    }
    .turn-indicator {
      font-weight: bold;
      color: #3498db;
      margin: 10px 0;
    }
    #mainGameArea, #gameModeBtns {
      transition: opacity 0.3s;
    }
    #offlineIndicator {
      background-color: #e74c3c;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      display: none;
      margin: 10px auto;
      width: fit-content;
    }
    #onlineIndicator {
      background-color: #27ae60;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      display: none;
      margin: 10px auto;
      width: fit-content;
    }
    #authContainer {
      margin-bottom: 20px;
    }
    #multiplayerBtns {
      margin-bottom: 20px;
      display: none;
    }
    .multiplayer-btn {
      padding: 10px 20px;
      margin: 5px;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      background-color: #3498db;
      color: white;
    }
    .multiplayer-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .room-code {
      font-family: monospace;
      font-size: 1.5rem;
      padding: 10px;
      background: #2c3e50;
      color: white;
      border-radius: 5px;
      margin: 10px 0;
    }
    .room-input {
      padding: 10px;
      width: 200px;
      font-size: 1.2rem;
      text-align: center;
      text-transform: uppercase;
      border: 2px solid #3498db;
      border-radius: 5px;
      margin: 10px 0;
    }
    .room-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 10px 0;
    }
    .copy-btn {
      background-color: #2ecc71;
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .copy-btn:hover {
      background-color: #27ae60;
    }
    .room-status {
      font-size: 1.1rem;
      margin: 10px 0;
      padding: 5px 10px;
      border-radius: 5px;
    }
    .status-waiting {
      background-color: #f1c40f;
      color: white;
    }
    .status-playing {
      background-color: #2ecc71;
      color: white;
    }
    .waiting-message {
      color: #e74c3c;
      font-weight: bold;
      margin: 10px 0;
    }
    .hint-level {
      font-size: 0.9rem;
      color: #7f8c8d;
      margin-top: 5px;
    }
    .player-notification {
      background-color: #3498db;
      color: white;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      animation: fadeIn 0.5s;
    }
    .start-game-btn {
      background-color: #27ae60;
      padding: 15px 30px;
      font-size: 1.2rem;
      margin: 20px 0;
      display: none;
    }
    .start-game-btn:hover {
      background-color: #219a52;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .player-list {
      margin: 15px 0;
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 5px;
    }
    .player-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 5px 0;
    }
    .player-avatar {
      width: 30px;
      height: 30px;
      background-color: #3498db;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>CitaResposta ü§™</h1>

    <div id="offlineIndicator">Modo Offline</div>
    <div id="onlineIndicator">Modo Online</div>

    <div id="gameModeBtns">
      <button id="singlePlayerBtn">Modo Solo</button>
      <button id="duetoBtn">Modo Dueto (1x1)</button>
      <button id="multiplayerBtn">Modo Multiplayer</button>
    </div>

    <div id="difficultyBtns">
      <div class="subtitle">Escolha o n√≠vel de dificuldade</div>
      <button id="easyBtn" class="difficulty-btn">F√°cil</button>
      <button id="mediumBtn" class="difficulty-btn">M√©dio</button>
      <button id="hardBtn" class="difficulty-btn">Dif√≠cil</button>
    </div>

    <div id="duetoSetup">
      <div class="subtitle">Configura√ß√£o do Modo Dueto</div>
      <input type="text" id="player1Name" placeholder="Nome do Jogador 1" value="Jogador 1" />
      <input type="text" id="player2Name" placeholder="Nome do Jogador 2" value="Jogador 2" />
      <button id="startDuetoBtn">Iniciar Dueto</button>
    </div>

    <div id="multiplayerBtns">
      <div class="subtitle">Escolha o tipo de conex√£o</div>
      <button id="webMultiplayerBtn" class="multiplayer-btn">Multiplayer Web</button>
      <button id="bluetoothMultiplayerBtn" class="multiplayer-btn">Bluetooth</button>
      <button id="localMultiplayerBtn" class="multiplayer-btn">Local (Mesma Rede)</button>
      
      <div id="webMultiplayerOptions" style="display: none;">
        <div class="subtitle">Escolha uma op√ß√£o</div>
        <div class="room-actions">
          <button id="createRoomBtn" class="multiplayer-btn">Criar Sala</button>
          <button id="enterRoomBtn" class="multiplayer-btn">Entrar em Sala</button>
        </div>
      </div>

      <div id="roomCodeContainer" style="display: none;">
        <div class="subtitle">C√≥digo da Sala</div>
        <div id="roomCode" class="room-code"></div>
        <div class="room-actions">
          <button id="copyCodeBtn" class="copy-btn">
            <span>üìã</span> Copiar C√≥digo
          </button>
        </div>
        <div id="playerList" class="player-list">
          <div class="subtitle">Jogadores na Sala</div>
          <div id="player1Item" class="player-item">
            <div class="player-avatar">1</div>
            <span>Voc√™ (Criador)</span>
          </div>
          <div id="player2Item" class="player-item" style="display: none;">
            <div class="player-avatar">2</div>
            <span id="player2Name">Aguardando jogador...</span>
          </div>
        </div>
        <div id="waitingMessage" class="waiting-message">Aguardando oponente...</div>
        <button id="startGameBtn" class="start-game-btn">Iniciar Jogo</button>
      </div>

      <div id="joinRoomContainer" style="display: none;">
        <div class="subtitle">Entrar em uma Sala</div>
        <input type="text" id="roomCodeInput" class="room-input" placeholder="Digite o c√≥digo" maxlength="6" />
        <div class="room-actions">
          <button id="joinRoomBtn" class="multiplayer-btn">Entrar na Sala</button>
          <button id="backToOptionsBtn" class="multiplayer-btn" style="background-color: #e74c3c;">Voltar</button>
        </div>
      </div>
    </div>

    <div id="mainGameArea" style="display:none;">
      <div id="player1Container" class="score">Pontua√ß√£o: 0</div>

      <div id="duetoInfo" style="display:none;">
        <div class="player-container">
          <div id="player1" class="player active-player">
            <div id="player1NameDisplay" class="player-name">Jogador 1</div>
            <div id="player1ScoreDisplay" class="player-score">0 pontos</div>
          </div>
          <div id="player2" class="player">
            <div id="player2NameDisplay" class="player-name">Jogador 2</div>
            <div id="player2ScoreDisplay" class="player-score">0 pontos</div>
          </div>
        </div>
        <div id="turnIndicator" class="turn-indicator">Vez de: Jogador 1</div>
        <div id="timer">Tempo: 30s</div>
      </div>

      <div class="question" id="question"></div>
      <input type="text" id="answerInput" placeholder="Sua resposta aqui..." />
      <br />
      <button id="submitBtn">Responder</button>
      <button id="restartBtn">Tentar Novamente</button>
      <button id="giveUpBtn">Desisto</button>
      <button id="noSenseBtn">Sem Sentido</button>
      <button id="secondChanceBtn">Me D√° uma Chance</button>
      <button id="skipBtn">Pular</button>
      <button id="hintBtn">Dica</button>
      <div class="feedback" id="feedback"></div>
    </div>

    <div id="networkStatus"></div>
  </div>

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, onSnapshot, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDonXj45fB7sRbg5S34uVgxJJT4H8beG0g",
      authDomain: "citaresposta.firebaseapp.com",
      projectId: "citaresposta",
      storageBucket: "citaresposta.firebasestorage.app",
      messagingSenderId: "843916427848",
      appId: "1:843916427848:web:373500363f7c7d1766ce7d",
      measurementId: "G-5ECLG79XGS"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Create a memory-based storage alternative
    const memoryStorage = {
      data: {},
      setItem: function(key, value) {
        this.data[key] = value;
      },
      getItem: function(key) {
        return this.data[key] || null;
      },
      removeItem: function(key) {
        delete this.data[key];
      },
      clear: function() {
        this.data = {};
      }
    };

    // Storage utility that tries localStorage first, falls back to memory storage
    const safeStorage = {
      setItem: function(key, value) {
        try {
          localStorage.setItem(key, value);
        } catch (e) {
          memoryStorage.setItem(key, value);
        }
      },
      getItem: function(key) {
        try {
          return localStorage.getItem(key);
        } catch (e) {
          return memoryStorage.getItem(key);
        }
      },
      removeItem: function(key) {
        try {
          localStorage.removeItem(key);
        } catch (e) {
          memoryStorage.removeItem(key);
        }
      },
      clear: function() {
        try {
          localStorage.clear();
        } catch (e) {
          memoryStorage.clear();
        }
      }
    };

    const questions = [
      {
        q: "Qual o √∫nico estado brasileiro que n√£o tem a letra A?",
        a: ["sergipe"]
      },
      {
        q: "Qual time n√£o canta o cruzeiro do hino nacional?",
        a: ["atletico-mg", "atl√©tico mg", "atletico mg"]
      },
      {
        q: "Qual pa√≠s tem as duas primeiras letras que se remete a um som de lobo?",
        a: ["austr√°lia", "australia"]
      },
      {
        q: "Qual o dedo que tem 4 irm√£o?",
        a: ["o dedo do meio", "dedo do meio", "meio"]
      },
      {
        q: "Qual estado brasileiro √© conhecido por ter mais vacas do que pessoas?",
        a: ["mato grosso"]
      },
      {
        q: "O que √© verde por fora, vermelho por dentro e anda sempre armado?",
        a: ["melancia"]
      },
      {
        q: "O que √© que tem cabe√ßa, tem dente, mas n√£o √© bicho nem √© gente?",
        a: ["alho"]
      },
      {
        q: "O que o tomate disse para o outro na corrida?",
        a: ["ketchup"]
      },
      {
        q: "Por que o livro foi ao m√©dico?",
        a: ["porque estava com muitas p√°ginas viradas"]
      },
      {
        q: "Por que o l√°pis foi preso?",
        a: ["porque ele escreveu uma coisa muito ruim"]
      },
      {
        q: "Qual √© o prato preferido do Batman?",
        a: ["morcego frito"]
      },
      {
        q: "Por que o computador foi ao m√©dico?",
        a: ["porque estava com v√≠rus"]
      },
      {
        q: "O que o pato disse para a pata?",
        a: ["vamos sair de patinhas"]
      },
      {
        q: "Qual √© a fruta preferida do vampiro?",
        a: ["morango sangrento"]
      },
      {
        q: "Por que o espantalho ganhou um pr√™mio?",
        a: ["porque ele era excepcional no campo"]
      },
      {
        q: "O que a mina pira no parque de divers√µes?",
        a: ["na montanha-russa"]
      },
      {
        q: "Qual √© o telefone do Batman?",
        a: ["batfone"]
      },
      {
        q: "O que o peixe faz quando sai da √°gua?",
        a: ["respira"]
      },
      {
        q: "Qual √© a dan√ßa que todo mundo sabe fazer?",
        a: ["quadradinho de oito"]
      },
      {
        q: "O que o gato disse para o rato?",
        a: ["quem comeu meu queijo"]
      },
      {
        q: "Por que os elefantes pintam as unhas do p√© de rosa?",
        a: ["para combinar com o papel de parede da selva"]
      },
      {
        q: "O que o rel√≥gio de pulso disse para a torradeira?",
        a: ["est√° na hora de torrar"]
      },
      {
        q: "Qual √© a cor do n√∫mero 7?",
        a: ["azul polca-dot"]
      },
      {
        q: "Por que as nuvens usam √≥culos escuros?",
        a: ["para se proteger do brilho do sol"]
      },
      {
        q: "O que a lua disse para o queijo?",
        a: ["voc√™ √© o meu crescente favorito"]
      },
      {
        q: "Qual √© a capital da Fran√ßa?",
        a: ["paris"]
      },
      {
        q: "Quantos dias tem uma semana?",
        a: ["7", "sete"]
      },
      {
        q: "Qual √© o maior planeta do sistema solar?",
        a: ["j√∫piter"]
      },
      {
        q: "Qual √© o s√≠mbolo qu√≠mico da √°gua?",
        a: ["h2o"]
      },
      {
        q: "Quantas patas tem uma aranha?",
        a: ["8", "oito"]
      },
      {
        q: "Qual √© o animal que tem o maior c√©rebro?",
        a: ["baleia"]
      },
      {
        q: "Qual √© o continente mais frio do mundo?",
        a: ["ant√°rtida", "antartica"]
      },
      {
        q: "Qual √© o pa√≠s conhecido como a terra do sol nascente?",
        a: ["jap√£o"]
      },
      {
        q: "Qual √© o maior oceano do mundo?",
        a: ["oceano pac√≠fico", "pacifico"]
      },
      {
        q: "Qual √© o nome do famoso detetive criado por Arthur Conan Doyle?",
        a: ["sherlock holmes"]
      },
      {
        q: "Qual √© o nome do famoso personagem de desenho animado que vive em um abacaxi no fundo do mar?",
        a: ["bob esponja"]
      },
      {
        q: "Qual √© o nome do famoso super-her√≥i que tem uma capa vermelha e voa pelo c√©u?",
        a: ["superman"]
      },
      {
        q: "Qual √© o nome do famoso personagem de desenho animado que √© um gato azul e adora comer queijo?",
        a: ["garfield"]
      },
      {
        q: "Qual √© o nome do famoso personagem de desenho animado que √© um pato e tem um amigo chamado Pato Donald?",
        a: ["pato donald"]
      },
      {
        q: "Qual √© o nome do famoso personagem de desenho animado que √© um coelho e adora cenouras?",
        a: ["bugs bunny"]
      },
      {
        q: "Qual √© o nome do famoso personagem de desenho animado que √© um cachorro e tem um amigo chamado Scooby-Doo?",
        a: ["scooby-doo"]
      },
      {
        q: "Qual √© o nome do famoso personagem de desenho animado que √© um porquinho e adora brincar na lama?",
        a: ["peppa pig"]
      },
      {
        q: "Qual √© o nome do famoso personagem de desenho animado que √© um pato e tem uma namorada chamada Margarida?",
        a: ["pato donald"]
      },
      {
        q: "Qual sentimento com a letra M faz seu cora√ß√£o bater mais forte?",
        a: ["medo", "motiva√ß√£o", "momentos", "mem√≥rias", "m√∫sica"]
      },
      {
        q: "O que come√ßa com S e voc√™ sempre procura numa pessoa?",
        a: ["sinceridade", "sabedoria", "simpatia", "sensatez", "solidariedade"]
      },
      {
        q: "Qual palavra que come√ßa com √â representa seu maior desejo?",
        a: ["√™xito", "esperan√ßa", "√©tica", "equil√≠brio", "evolu√ß√£o"]
      },
      {
        q: "O que come√ßa com M e n√£o pode faltar em sua vida?",
        a: ["m√∫sica", "mem√≥rias", "momentos", "motiva√ß√£o", "medicina"]
      },
      {
        q: "Qual palavra com S representa sua melhor qualidade?",
        a: ["simpatia", "sinceridade", "sabedoria", "sensibilidade", "sensatez"]
      },
      {
        q: "Qual √© a cor do cavalo branco de Napole√£o?",
        a: ["branco"]
      },
      {
        q: "Quanto √© 2 + 2 √ó 2?",
        a: ["6", "seis"]
      },
      {
        q: "Quantos animais de cada esp√©cie Mois√©s levou na arca?",
        a: ["nenhum", "zero", "0", "foi no√©, n√£o mois√©s"]
      },
      {
        q: "Se voc√™ jogar uma pedra vermelha em um lago azul, o que acontece?",
        a: ["a pedra afunda", "afunda", "molha", "cai na √°gua"]
      },
      {
        q: "Qual m√™s tem 28 dias?",
        a: ["todos", "todos os meses", "janeiro", "fevereiro", "mar√ßo", "abril", "maio", "junho", "julho", "agosto", "setembro", "outubro", "novembro", "dezembro"]
      },
      {
        q: "O que te permite ver al√©m das apar√™ncias e julgar as pessoas pelo que elas realmente s√£o?",
        a: ["empatia", "sabedoria", "compreens√£o", "discernimento", "perspic√°cia"]
      },
      {
        q: "Qual caracter√≠stica √© essencial para enfrentar desafios que parecem imposs√≠veis?",
        a: ["perseveran√ßa", "coragem", "determina√ß√£o", "resili√™ncia", "for√ßa", "f√©", "persist√™ncia"]
      },
      {
        q: "O que √© necess√°rio cultivar para construir relacionamentos duradouros?",
        a: ["paci√™ncia", "respeito", "lealdade", "honestidade", "confian√ßa", "compreens√£o", "toler√¢ncia"]
      },
      {
        q: "Qual virtude ajuda a perdoar aqueles que nos magoaram profundamente?",
        a: ["compaix√£o", "bondade", "miseric√≥rdia", "amor", "generosidade", "humildade", "compreens√£o"]
      },
      {
        q: "O que precisa ter para assumir responsabilidade pelos pr√≥prios erros?",
        a: ["humildade", "honestidade", "maturidade", "integridade", "coragem", "car√°ter"]
      },
      {
        q: "O que um f√£ faz quando descobre que seu artista favorito vem para sua cidade?",
        a: ["compra ingresso", "acampa na fila", "economiza dinheiro", "posta nas redes sociais", "grita", "chora", "enlouquece"]
      },
      {
        q: "Como um verdadeiro f√£ age quando encontra seu √≠dolo pessoalmente?",
        a: ["tira foto", "pede aut√≥grafo", "chora", "congela", "gagueja", "abra√ßa", "n√£o consegue falar", "treme", "desmaia"]
      },
      {
        q: "O que um f√£ obsessivo coleciona de seu √≠dolo ou s√©rie favorita?",
        a: ["p√¥steres", "figurinhas", "camisetas", "ingressos", "√°lbuns", "fotos", "aut√≥grafos", "action figures", "revistas", "itens raros"]
      },
      {
        q: "Como um super f√£ demonstra seu amor pelo time do cora√ß√£o?",
        a: ["tatua o s√≠mbolo", "vai a todos os jogos", "compra camisas", "decora a casa", "defende nas redes sociais", "nunca perde um jogo", "conhece todos os jogadores", "sabe o hino"]
      },
      {
        q: "O que um f√£ extremo faz nas redes sociais em rela√ß√£o ao seu √≠dolo?",
        a: ["segue todas as contas", "comenta em todas as fotos", "defende de haters", "cria f√£-clube", "faz edits", "posta teorias", "compartilha tudo", "cria memes", "sabe todos os detalhes"]
      },
      {
        q: "Qual brincadeira tradicional envolve uma pessoa de olhos fechados tentando pegar os outros?",
        a: ["pega-pega", "cabra-cega", "esconde-esconde com pegador", "pique-esconde", "cobra-cega"]
      },
      {
        q: "Em qual brincadeira as crian√ßas pulam sobre um desenho feito no ch√£o com giz ou riscado na terra?",
        a: ["amarelinha", "academia", "macaco", "sapata", "mar√©"]
      },
      {
        q: "Qual brincadeira envolve passar um objeto escondido enquanto uma m√∫sica toca, e quem estiver com ele quando a m√∫sica para √© eliminado?",
        a: ["batata quente", "passa anel", "dan√ßa das cadeiras", "len√ßo atr√°s", "stop"]
      },
      {
        q: "Qual √© a brincadeira onde voc√™ precisa equilibrar uma pedra sobre outra empilhada?",
        a: ["cinco marias", "pedrinhas", "jogo das pedrinhas", "jogo do osso", "bilboqu√™", "amarelinha de pedra"]
      },
      {
        q: "Em qual brincadeira as crian√ßas formam uma roda, giram e depois caem sentadas no ch√£o?",
        a: ["ciranda", "roda", "roda-roda", "corre-cutia", "dan√ßa da cadeira sem cadeira", "gato e rato", "roda pi√£o"]
      },
      {
        q: "O que voc√™ diz quando precisa que algu√©m repita o que acabou de falar?",
        a: ["o qu√™?", "como?", "repete por favor", "n√£o entendi", "pode repetir", "fala de novo", "h√£?"]
      },
      {
        q: "O que voc√™ diz quando quer que algu√©m te passe o sal durante uma refei√ß√£o?",
        a: ["me passa o sal", "passa o sal", "por favor, o sal", "o sal, por favor", "poderia me passar o sal"]
      },
      {
        q: "O que voc√™ diz quando precisa de um tempo extra para completar uma tarefa?",
        a: ["mais tempo", "preciso de mais tempo", "me d√° um prazo maior", "posso ter uma extens√£o", "espera um pouco"]
      },
      {
        q: "O que voc√™ fala para pedir carona a um amigo?",
        a: ["me d√° uma carona", "pode me dar carona", "t√° indo pra onde", "vai passar perto de", "t√¥ sem carro", "me leva"]
      },
      {
        q: "O que voc√™ diz quando quer um desconto numa loja?",
        a: ["tem desconto", "faz um desconto", "pode melhorar o pre√ßo", "√† vista tem desconto", "tem promo√ß√£o", "esse √© o menor pre√ßo"]
      },
      {
        q: "O que algu√©m diz nas redes sociais quando quer atingir uma pessoa espec√≠fica sem mencionar seu nome?",
        a: ["quem se identificou √© porque √©", "pra quem serviu a carapu√ßa", "alguns v√£o entender", "n√£o √© indireta mas", "algu√©m precisa ouvir isso", "s√≥ observo"]
      },
      {
        q: "O que uma pessoa fala quando quer dar a entender que est√° ocupada demais para algum convite?",
        a: ["vou ver minha agenda", "te aviso depois", "n√£o sei se vou estar livre", "quem sabe", "vamos combinar", "talvez", "preciso confirmar"]
      },
      {
        q: "Qual frase √© usada quando algu√©m quer sugerir que est√° na hora da visita ir embora?",
        a: ["nossa, j√° est√° tarde", "amanh√£ acordo cedo", "preciso dormir", "vou tomar um banho", "amanh√£ tenho compromisso", "que horas s√£o?"]
      },
      {
        q: "O que algu√©m diz quando n√£o gostou da comida mas n√£o quer ofender quem cozinhou?",
        a: ["est√° diferente", "√© uma receita interessante", "nunca provei algo assim", "j√° estou satisfeito", "√© bem original", "tem um sabor √∫nico"]
      },
      {
        q: "O que uma pessoa fala quando quer dar a entender que algu√©m est√° sendo inconveniente em um grupo?",
        a: ["nossa, algu√©m acordou de mau humor", "tem gente que n√£o sabe brincar", "n√£o √© todo mundo que entende", "algu√©m n√£o est√° no clima hoje", "certas pessoas precisam relaxar"]
      },
      {
        q: "Qual fruta √© conhecida como a 'ma√ß√£ dourada' e √© famosa por ser a fruta que causou a 'Guerra de Troia' na mitologia grega?",
        a: ["ma√ß√£"]
      },
      {
        q: "Que fruta tem casca verde e polpa vermelha, e √© frequentemente usada em saladas de frutas e sucos?",
        a: ["melancia"]
      },
      {
        q: "Qual fruta tropical √© amarela e tem um formato alongado, sendo muito popular em smoothies e vitaminas?",
        a: ["banana"]
      },
      {
        q: "Que fruta pequena e vermelha √© famosa por ser a preferida da Branca de Neve?",
        a: ["ma√ß√£"]
      },
      {
        q: "Qual fruta c√≠trica √© conhecida por ser amarela e muito rica em vitamina C?",
        a: ["lim√£o"]
      },
      {
        q: "O que um fofoqueiro sempre quer saber sobre os outros?",
        a: ["novidades", "segredos", "fuxicos", "hist√≥rias"]
      },
      {
        q: "Qual √© o principal assunto de conversa entre fofoqueiros em uma festa?",
        a: ["outras pessoas", "vida alheia", "novidades", "fuxicos"]
      },
      {
        q: "O que um fofoqueiro adora espalhar, mesmo que n√£o seja verdade?",
        a: ["boatos", "rumores", "intrigas", "hist√≥rias"]
      },
      {
        q: "Onde os fofoqueiros geralmente se re√∫nem para trocar informa√ß√µes?",
        a: ["rodas de conversa", "grupos de amigos", "redes sociais", "eventos"]
      },
      {
        q: "O que um fofoqueiro faz quando descobre um segredo?",
        a: ["compartilha", "conta para os outros", "espalha", "d√° com a l√≠ngua nos dentes"]
      },
      {
        q: "O que voc√™ pensa quando algu√©m diz 'Pense em um n√∫mero'?",
        a: ["um n√∫mero", "n√∫mero aleat√≥rio", "qualquer n√∫mero"]
      },
      {
        q: "O que vem √† mente quando voc√™ ouve a palavra 'felicidade'?",
        a: ["sorriso", "alegria", "momentos felizes", "satisfa√ß√£o"]
      },
      {
        q: "O que voc√™ imagina quando algu√©m menciona 'um lugar tranquilo'?",
        a: ["praia", "montanha", "natureza", "casa"]
      },
      {
        q: "O que voc√™ pensa quando algu√©m pergunta 'Qual √© o seu sonho?'",
        a: ["objetivo de vida", "realiza√ß√£o pessoal", "futuro", "aspira√ß√µes"]
      },
      {
        q: "O que vem √† sua mente quando voc√™ ouve a palavra 'liberdade'?",
        a: ["independ√™ncia", "viajar", "fazer o que quiser", "escolhas"]
      },
      {
        q: "√â verdade que a Terra gira em torno do Sol?",
        a: ["sim", "verdade", "isso √© verdade"]
      },
      {
        q: "A √°gua ferve a 100 graus Celsius ao n√≠vel do mar. Isso √© verdade?",
        a: ["sim", "verdade", "isso √© verdade"]
      },
      {
        q: "√â verdade que o Brasil √© o maior pa√≠s da Am√©rica do Sul?",
        a: ["sim", "verdade", "isso √© verdade"]
      },
      {
        q: "O oxig√™nio √© essencial para a respira√ß√£o humana. Isso √© verdade?",
        a: ["sim", "verdade", "isso √© verdade"]
      },
      {
        q: "√â verdade que a Grande Muralha da China √© vis√≠vel a olho nu do espa√ßo?",
        a: ["n√£o", "falso", "isso n√£o √© verdade"]
      },
      {
        q: "Qual √© o apelido que s√≥ seus amigos mais pr√≥ximos usam para te chamar?",
        a: ["seu apelido pessoal"],
        freeAnswer: true
      },
      {
        q: "Qual foi o lugar mais inusitado onde voc√™ e seus amigos j√° se encontraram?",
        a: ["um lugar inusitado que s√≥ seus amigos saberiam"],
        freeAnswer: true
      },
      {
        q: "Qual √© a comida ou prato que seus amigos sabem que voc√™ nunca recusa?",
        a: ["sua comida ou prato favorito"],
        freeAnswer: true
      },
      {
        q: "Qual √© a m√∫sica que sempre toca quando voc√™ e seus amigos se re√∫nem?",
        a: ["uma m√∫sica que s√≥ seus amigos conhecem"],
        freeAnswer: true
      },
      {
        q: "Qual √© a piada interna ou bord√£o que s√≥ voc√™ e seu grupo de amigos entendem?",
        a: ["uma piada interna ou bord√£o espec√≠fico"],
        freeAnswer: true
      },
      {
        q: "Qual √© o nome do autor de 'Dom Quixote'?",
        a: ["miguel de cervantes"]
      },
      {
        q: "Em qual livro voc√™ encontraria o personagem Holden Caulfield?",
        a: ["o apanhador no campo de centeio"]
      },
      {
        q: "Quem escreveu o romance 'Orgulho e Preconceito'?",
        a: ["jane austen"]
      },
      {
        q: "Qual √© o t√≠tulo do primeiro livro da s√©rie 'Harry Potter'?",
        a: ["harry potter e a pedra filosofal"]
      },
      {
        q: "Quem √© o autor de 'Cem Anos de Solid√£o'?",
        a: ["gabriel garc√≠a m√°rquez"]
      },
      {
        q: "Qual √© o nome do protagonista principal de Dragon Ball?",
        a: ["goku", "son goku"]
      },
      {
        q: "Qual √© o nome do irm√£o mais velho de Goku?",
        a: ["raditz"]
      },
      {
        q: "Qual √© o nome do filho de Goku e Chi-Chi?",
        a: ["gohan"]
      },
      {
        q: "Qual √© o nome do inimigo que destruiu o Planeta Vegeta?",
        a: ["freeza"]
      },
      {
        q: "Qual √© o nome da t√©cnica mais famosa de Goku, onde ele se transforma em um Super Saiyajin?",
        a: ["super saiyajin", "super saiyan"]
      },
      {
        q: "Qual √© o nome do protagonista principal de Naruto?",
        a: ["naruto uzumaki"]
      },
      {
        q: "Qual √© o nome do melhor amigo e rival de Naruto?",
        a: ["sasuke uchiha"]
      },
      {
        q: "Qual √© o nome da t√©cnica de invoca√ß√£o usada por Naruto para chamar sapos?",
        a: ["kuchiyose no jutsu"]
      },
      {
        q: "Qual √© o nome do sensei de Naruto, Sasuke e Sakura?",
        a: ["kakashi hatake"]
      },
      {
        q: "Qual √© o nome do vil√£o principal que Naruto enfrenta no exame Chunin?",
        a: ["orochimaru"]
      },
      {
        q: "Qual √© o nome do protagonista principal de One Piece?",
        a: ["monkey d. luffy"]
      },
      {
        q: "Qual √© o nome do pirata que possui o poder da fruta Gomu Gomu no Mi?",
        a: ["luffy"]
      },
      {
        q: "Qual √© o nome do espadachim da tripula√ß√£o do Chap√©u de Palha?",
        a: ["roronoa zoro"]
      },
      {
        q: "Qual √© o nome do navio da tripula√ß√£o do Chap√©u de Palha?",
        a: ["thousand sunny"]
      },
      {
        q: "Qual √© o nome do tesouro que Luffy est√° procurando para se tornar o Rei dos Piratas?",
        a: ["one piece"]
      },
      {
        q: "Qual √© o seu maior sonho?",
        a: ["seu sonho pessoal"],
        freeAnswer: true
      },
      {
        q: "Qual √© o lugar que voc√™ mais gostaria de conhecer?",
        a: ["seu lugar favorito"],
        freeAnswer: true
      },
      {
        q: "Qual √© a sua mem√≥ria mais feliz?",
        a: ["sua mem√≥ria feliz"],
        freeAnswer: true
      },
      {
        q: "Qual √© a sua maior conquista at√© hoje?",
        a: ["sua conquista"],
        freeAnswer: true
      },
      {
        q: "Qual √© o seu maior medo?",
        a: ["seu medo"],
        freeAnswer: true
      }
    ];

    // Vari√°veis do jogo
    let current = 0;
    let score = 0;
    let correctAnswers = 0;
    let skipsAvailable = 0;
    let hintsAvailable = 3;
    let gameMode = 'single';
    let currentPlayer = 1;
    let player1Score = 0;
    let player2Score = 0;
    let player1Name = "Jogador 1";
    let player2Name = "Jogador 2";
    let timerInterval;
    let timeLeft = 30;
    let isOnline = true;
    let userId = null;
    let difficulty = 'medium';
    let filteredQuestions = [];
    let hintLevel = 1; // N√≠vel da dica atual
    let multiplayerConnection = null;
    let roomCode = null;

    // Classificar as quest√µes por dificuldade
    const easyQuestions = questions.filter(q => q.difficulty === 'easy' || !q.difficulty);
    const mediumQuestions = questions.filter(q => q.difficulty === 'medium' || !q.difficulty);
    const hardQuestions = questions.filter(q => q.difficulty === 'hard' || !q.difficulty);

    // Detec√ß√£o de Conectividade
    window.addEventListener('load', checkConnection);
    window.addEventListener('online', checkConnection);
    window.addEventListener('offline', checkConnection);

    function checkConnection() {
      isOnline = navigator.onLine;
      document.getElementById('networkStatus').textContent = isOnline ?
        "Status: Conectado" : "Status: Desconectado";

      document.getElementById('offlineIndicator').style.display =
        isOnline ? 'none' : 'block';
      document.getElementById('onlineIndicator').style.display =
        isOnline ? 'block' : 'none';

      // Se estiver offline, guarde dados localmente
      if (!isOnline) {
        saveGameState();
      }
    }

    // Salvar e Recuperar Estado do Jogo (com safeStorage em vez de localStorage)
    function saveGameState() {
      const gameState = {
        current,
        score,
        correctAnswers,
        skipsAvailable,
        hintsAvailable,
        gameMode,
        currentPlayer,
        player1Score,
        player2Score,
        player1Name,
        player2Name
      };

      if (userId) {
        setDoc(doc(db, "gameStates", userId), gameState);
      } else {
        safeStorage.setItem('citaRespostaGameState', JSON.stringify(gameState));
      }
    }

    async function loadGameState() {
      if (userId) {
        const docRef = doc(db, "gameStates", userId);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          const gameState = docSnap.data();
          current = gameState.current;
          score = gameState.score;
          correctAnswers = gameState.correctAnswers;
          skipsAvailable = gameState.skipsAvailable;
          hintsAvailable = gameState.hintsAvailable;
          gameMode = gameState.gameMode;
          currentPlayer = gameState.currentPlayer;
          player1Score = gameState.player1Score;
          player2Score = gameState.player2Score;
          player1Name = gameState.player1Name;
          player2Name = gameState.player2Name;

          // Atualizar interface
          updateScore();
          if (gameMode === 'dueto') {
            updateDuetoDisplay();
          }
        }
      } else {
        const savedState = safeStorage.getItem('citaRespostaGameState');
        if (savedState) {
          const gameState = JSON.parse(savedState);
          current = gameState.current;
          score = gameState.score;
          correctAnswers = gameState.correctAnswers;
          skipsAvailable = gameState.skipsAvailable;
          hintsAvailable = gameState.hintsAvailable;
          gameMode = gameState.gameMode;
          currentPlayer = gameState.currentPlayer;
          player1Score = gameState.player1Score;
          player2Score = gameState.player2Score;
          player1Name = gameState.player1Name;
          player2Name = gameState.player2Name;

          // Atualizar interface
          updateScore();
          if (gameMode === 'dueto') {
            updateDuetoDisplay();
          }
        }
      }
    }

    // Fun√ß√µes de Autentica√ß√£o
    function registerUser() {
      const email = document.getElementById('emailInput').value;
      const password = document.getElementById('passwordInput').value;
      createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          userId = userCredential.user.uid;
          alert("Usu√°rio registrado com sucesso!");
        })
        .catch((error) => {
          alert("Erro ao registrar usu√°rio: " + error.message);
        });
    }
    // Inicializa√ß√£o e Eventos
    document.getElementById('singlePlayerBtn').addEventListener('click', startSinglePlayerMode);
    document.getElementById('duetoBtn').addEventListener('click', showDuetoSetup);
    document.getElementById('startDuetoBtn').addEventListener('click', startDuetoMode);

    function startSinglePlayerMode() {
      gameMode = 'single';
      document.getElementById('gameModeBtns').style.display = 'none';
      document.getElementById('difficultyBtns').style.display = 'block';
    }

    function showDuetoSetup() {
      document.getElementById('gameModeBtns').style.display = 'none';
      document.getElementById('duetoSetup').style.display = 'block';
    }

    function startDuetoMode() {
      gameMode = 'dueto';
      player1Name = document.getElementById('player1Name').value || "Jogador 1";
      player2Name = document.getElementById('player2Name').value || "Jogador 2";
      player1Score = 0;
      player2Score = 0;
      currentPlayer = 1;

      document.getElementById('duetoSetup').style.display = 'none';
      document.getElementById('difficultyBtns').style.display = 'block';
    }

    function setDifficulty(level) {
      difficulty = level;
      document.getElementById('difficultyBtns').style.display = 'none';
      document.getElementById('mainGameArea').style.display = 'block';
      document.getElementById('player1Container').style.display = gameMode === 'single' ? 'block' : 'none';
      document.getElementById('duetoInfo').style.display = gameMode === 'dueto' ? 'block' : 'none';

      // Filtrar quest√µes baseado na dificuldade
      switch(level) {
        case 'easy':
          filteredQuestions = easyQuestions;
          timeLeft = 45; // Mais tempo para respostas f√°ceis
          break;
        case 'medium':
          filteredQuestions = mediumQuestions;
          timeLeft = 30;
          break;
        case 'hard':
          filteredQuestions = hardQuestions;
          timeLeft = 20; // Menos tempo para respostas dif√≠ceis
          break;
      }

      // Atualizar nomes dos jogadores no modo dueto
      if (gameMode === 'dueto') {
        document.getElementById('player1NameDisplay').textContent = player1Name;
        document.getElementById('player2NameDisplay').textContent = player2Name;
        updateDuetoDisplay();
      }

      restartGame();
      if (gameMode === 'dueto') {
        startTimer();
      }
    }

    function updateDuetoDisplay() {
      document.getElementById('player1ScoreDisplay').textContent = `${player1Score} pontos`;
      document.getElementById('player2ScoreDisplay').textContent = `${player2Score} pontos`;
      document.getElementById('turnIndicator').textContent = `Vez de: ${currentPlayer === 1 ? player1Name : player2Name}`;

      // Destacar jogador atual
      document.getElementById('player1').className = currentPlayer === 1 ? 'player active-player' : 'player';
      document.getElementById('player2').className = currentPlayer === 2 ? 'player active-player' : 'player';
    }

    function switchPlayer() {
      currentPlayer = currentPlayer === 1 ? 2 : 1;
      updateDuetoDisplay();
      resetTimer();
    }

    function startTimer() {
      if (gameMode !== 'dueto') return;

      clearInterval(timerInterval);
      timeLeft = 30;
      document.getElementById('timer').textContent = `Tempo: ${timeLeft}s`;

      timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').textContent = `Tempo: ${timeLeft}s`;

        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          document.getElementById('feedback').textContent = "‚è∞ Tempo esgotado!";
          switchPlayer();
          setTimeout(showQuestion, 1500);
        }
      }, 1000);
    }

    function resetTimer() {
      clearInterval(timerInterval);
      startTimer();
    }

    function showQuestion() {
      document.getElementById("question").textContent = filteredQuestions[current].q;
      document.getElementById("answerInput").value = "";
      document.getElementById("feedback").textContent = "";
      document.getElementById("answerInput").disabled = false;
      document.getElementById("submitBtn").disabled = false;
      document.getElementById("giveUpBtn").style.display = "inline-block";
      document.getElementById("noSenseBtn").style.display = "inline-block";
      document.getElementById("secondChanceBtn").style.display = "inline-block";
      document.getElementById("restartBtn").style.display = "none";

      // Mostrar indicador de dificuldade
      const difficultyIndicator = document.createElement('div');
      difficultyIndicator.className = `difficulty-indicator ${difficulty}`;
      difficultyIndicator.textContent = `N√≠vel: ${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)}`;
      document.getElementById("question").parentNode.insertBefore(difficultyIndicator, document.getElementById("question"));

      // Mostrar bot√£o de dica se houver dicas dispon√≠veis
      if (hintsAvailable > 0) {
        document.getElementById("hintBtn").style.display = "inline-block";
      } else {
        document.getElementById("hintBtn").style.display = "none";
      }

      if (gameMode === 'dueto') {
        resetTimer();
      }

      if (skipsAvailable > 0) {
        document.getElementById("skipBtn").style.display = "inline-block";
      } else {
        document.getElementById("skipBtn").style.display = "none";
      }

      saveGameState();
    }

    function updateScore() {
      if (gameMode === 'single') {
        document.getElementById("player1Container").textContent = `Pontua√ß√£o: ${score}`;
      } else {
        updateDuetoDisplay();
      }
      saveGameState();
    }

    function checkAnswer() {
      const input = document.getElementById("answerInput").value.trim().toLowerCase();
      const validAnswers = filteredQuestions[current].a;
      const feedback = document.getElementById("feedback");

      if (filteredQuestions[current].freeAnswer) {
        if (input.length > 0) {
          feedback.textContent = "üéâ Resposta aceita!";

          if (gameMode === 'multiplayer') {
            const points = difficulty === 'easy' ? 5 : difficulty === 'medium' ? 10 : 15;
            if (currentPlayer === 1) {
              player1Score += points;
            } else {
              player2Score += points;
            }
            updateGameState({
              currentPlayer: currentPlayer === 1 ? 2 : 1,
              timeLeft: 30,
              currentQuestion: current + 1
            });
          }

          updateScore();
          current++;

          if (current < filteredQuestions.length) {
            if (gameMode === 'dueto') {
              switchPlayer();
            }
            setTimeout(showQuestion, 2000);
          } else {
            endGame();
          }
        } else {
          feedback.textContent = "‚ùå Por favor, digite uma resposta!";
        }
        return;
      }

      const isCorrect = validAnswers.some(ans => input.includes(ans));

      if (isCorrect) {
        feedback.textContent = "üéâ Acertou, mizeravi!";

        if (gameMode === 'multiplayer') {
          const points = difficulty === 'easy' ? 5 : difficulty === 'medium' ? 10 : 15;
          if (currentPlayer === 1) {
            player1Score += points;
          } else {
            player2Score += points;
          }
          updateGameState({
            currentPlayer: currentPlayer === 1 ? 2 : 1,
            timeLeft: 30,
            currentQuestion: current + 1
          });
        }

        updateScore();
        current++;

        if (current < filteredQuestions.length) {
          if (gameMode === 'dueto') {
            switchPlayer();
          }
          setTimeout(showQuestion, 2000);
        } else {
          endGame();
        }
      } else {
        feedback.textContent = "‚ùå Errou!";

        if (gameMode === 'multiplayer') {
          updateGameState({
            currentPlayer: currentPlayer === 1 ? 2 : 1,
            timeLeft: 30
          });
        }

        if (gameMode === 'single') {
          feedback.textContent += " Fim de jogo!";
          document.getElementById("answerInput").disabled = true;
          document.getElementById("submitBtn").disabled = true;
          document.getElementById("restartBtn").style.display = "inline-block";
          document.getElementById("giveUpBtn").style.display = "none";
          document.getElementById("noSenseBtn").style.display = "none";
          document.getElementById("secondChanceBtn").style.display = "none";
          document.getElementById("skipBtn").style.display = "none";

          correctAnswers = 0;
          skipsAvailable = 0;
        } else {
          feedback.textContent += " Vez do pr√≥ximo jogador!";
          switchPlayer();
          setTimeout(showQuestion, 2000);
        }
      }
    }

    function endGame() {
      clearInterval(timerInterval);

      if (gameMode === 'single') {
        feedback.textContent = "üèÅ Fim do jogo! Voc√™ manja das zoeiras!";
      } else {
        // Determinar vencedor no modo dueto
        let winnerMessage = "";
        if (player1Score > player2Score) {
          winnerMessage = `üèÜ ${player1Name} venceu com ${player1Score} pontos!`;
        } else if (player2Score > player1Score) {
          winnerMessage = `üèÜ ${player2Name} venceu com ${player2Score} pontos!`;
        } else {
          winnerMessage = "üèÜ Empate! Ambos jogadores mandaram bem!";
        }

        document.getElementById("feedback").textContent = "üèÅ Fim do jogo!";
        document.getElementById("feedback").innerHTML += `<div class="winner">${winnerMessage}</div>`;
      }

      document.getElementById("question").textContent = "";
      document.getElementById("answerInput").style.display = "none";
      document.getElementById("submitBtn").style.display = "none";
      document.getElementById("giveUpBtn").style.display = "none";
      document.getElementById("noSenseBtn").style.display = "none";
      document.getElementById("secondChanceBtn").style.display = "none";
      document.getElementById("skipBtn").style.display = "none";
      document.getElementById("restartBtn").style.display = "inline-block";

      if (userId) {
        setDoc(doc(db, "gameStates", userId), {});
      } else {
        safeStorage.removeItem('citaRespostaGameState');
      }
    }

    function skipQuestion() {
      if (skipsAvailable > 0) {
        skipsAvailable--;
        document.getElementById("feedback").textContent = "Quest√£o pulada! ü¶ò";
        current++;
        
        if (gameMode === 'multiplayer') {
          updateGameState({
            currentPlayer: currentPlayer === 1 ? 2 : 1,
            timeLeft: 30,
            currentQuestion: current
          });
        }
        
        if (current < filteredQuestions.length) {
          setTimeout(showQuestion, 1000);
        } else {
          endGame();
        }
      }
    }

    // Fun√ß√£o para gerar dicas mais elaboradas
    function generateHint(question) {
      const hints = [];
      
      // Dica n√≠vel 1: Primeira letra
      hints.push(`A resposta come√ßa com a letra "${question.a[0][0].toUpperCase()}"`);
      
      // Dica n√≠vel 2: Tamanho da palavra
      if (question.a[0].length <= 3) {
        hints.push("√â uma palavra curta");
      } else if (question.a[0].length <= 6) {
        hints.push("√â uma palavra de tamanho m√©dio");
      } else {
        hints.push("√â uma palavra longa");
      }
      
      // Dica n√≠vel 3: Categoria ou contexto
      if (question.q.includes("fruta")) {
        hints.push("√â uma fruta");
      } else if (question.q.includes("animal")) {
        hints.push("√â um animal");
      } else if (question.q.includes("pa√≠s")) {
        hints.push("√â um pa√≠s");
      } else if (question.q.includes("cidade")) {
        hints.push("√â uma cidade");
      } else if (question.q.includes("cor")) {
        hints.push("√â uma cor");
      } else if (question.q.includes("n√∫mero")) {
        hints.push("√â um n√∫mero");
      }
      
      // Dica n√≠vel 4: Letras em posi√ß√µes espec√≠ficas
      if (question.a[0].length > 3) {
        const middleIndex = Math.floor(question.a[0].length / 2);
        hints.push(`A letra do meio √© "${question.a[0][middleIndex].toUpperCase()}"`);
      }
      
      // Dica n√≠vel 5: √öltima letra
      hints.push(`A resposta termina com a letra "${question.a[0][question.a[0].length - 1].toUpperCase()}"`);
      
      return hints;
    }

    function showHint() {
      if (hintsAvailable > 0) {
        hintsAvailable--;
        const currentQuestion = filteredQuestions[current];
        const hints = generateHint(currentQuestion);
        
        const hintText = hints[Math.min(hintLevel - 1, hints.length - 1)];
        document.getElementById("feedback").innerHTML = `
          <div class="hint-text">üí° Dica: ${hintText}</div>
          <div class="hint-level">N√≠vel da dica: ${hintLevel}/5</div>
        `;
        
        hintLevel = Math.min(hintLevel + 1, 5);
        
        document.getElementById("hintBtn").style.display = hintsAvailable > 0 ? "inline-block" : "none";
        
        if (gameMode === 'multiplayer') {
          updateGameState({
            timeLeft: timeLeft
          });
        }
      }
    }

    function restartGame() {
      current = Math.floor(Math.random() * filteredQuestions.length);
      document.getElementById("answerInput").style.display = "inline-block";
      document.getElementById("submitBtn").style.display = "inline-block";

      if (gameMode === 'single') {
        score = 0;
        correctAnswers = 0;
        skipsAvailable = 0;
        hintsAvailable = 3;
      } else {
        player1Score = 0;
        player2Score = 0;
        currentPlayer = 1;
        updateDuetoDisplay();
        resetTimer();
      }

      updateScore();
      showQuestion();
    }

    function giveUp() {
      document.getElementById("feedback").textContent = "Voc√™ desistiu! Tente novamente.";

      if (gameMode === 'single') {
        correctAnswers = 0;
        skipsAvailable = 0;
      } else {
        clearInterval(timerInterval);
      }

      restartGame();
    }

    function noSense() {
      current = Math.floor(Math.random() * filteredQuestions.length);
      while (filteredQuestions[current].a.length > 0 && filteredQuestions[current].a[0].length > 4) {
        current = Math.floor(Math.random() * filteredQuestions.length);
      }

      if (gameMode === 'dueto') {
        resetTimer();
      }

      showQuestion();
    }

    function secondChance() {
      document.getElementById("feedback").textContent = "Tente novamente com a mesma pergunta!";
      document.getElementById("answerInput").value = "";

      if (gameMode === 'dueto') {
        resetTimer();
      }
    }

    // Fun√ß√µes de Multiplayer
    function showMultiplayerOptions() {
      document.getElementById('gameModeBtns').style.display = 'none';
      document.getElementById('multiplayerBtns').style.display = 'block';
      document.getElementById('webMultiplayerOptions').style.display = 'none';
      document.getElementById('roomCodeContainer').style.display = 'none';
      document.getElementById('joinRoomContainer').style.display = 'none';
    }

    function showWebMultiplayerOptions() {
      document.getElementById('webMultiplayerOptions').style.display = 'block';
    }

    function showCreateRoom() {
      document.getElementById('webMultiplayerOptions').style.display = 'none';
      startWebMultiplayer();
    }

    function showJoinRoom() {
      document.getElementById('webMultiplayerOptions').style.display = 'none';
      document.getElementById('joinRoomContainer').style.display = 'block';
    }

    async function startWebMultiplayer() {
      try {
        // Gerar c√≥digo da sala
        roomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
        document.getElementById('roomCode').textContent = roomCode;
        document.getElementById('roomCodeContainer').style.display = 'block';
        
        // Criar sala no Firebase
        const roomRef = doc(db, "rooms", roomCode);
        await setDoc(roomRef, {
          created: new Date(),
          status: 'waiting',
          players: [{
            id: userId,
            name: player1Name,
            isHost: true,
            score: 0,
            hintsAvailable: 3,
            skipsAvailable: 0
          }],
          gameState: {
            currentPlayer: 1,
            difficulty: 'medium',
            timeLeft: 30,
            currentQuestion: 0
          }
        });

        // Configurar listener para mudan√ßas na sala
        onSnapshot(roomRef, (doc) => {
          const roomData = doc.data();
          if (!roomData) return;

          // Atualizar lista de jogadores
          if (roomData.players.length === 2) {
            const player2 = roomData.players.find(p => p.id !== userId);
            if (player2) {
              document.getElementById('player2Item').style.display = 'flex';
              document.getElementById('player2Name').textContent = player2.name;
              
              // Mostrar notifica√ß√£o
              const notification = document.createElement('div');
              notification.className = 'player-notification';
              notification.textContent = `${player2.name} entrou na sala!`;
              document.getElementById('roomCodeContainer').insertBefore(
                notification,
                document.getElementById('startGameBtn')
              );
              
              // Mostrar bot√£o de iniciar
              document.getElementById('startGameBtn').style.display = 'block';
              
              // Remover notifica√ß√£o ap√≥s 3 segundos
              setTimeout(() => {
                notification.remove();
              }, 3000);
            }
          }

          // Atualizar estado do jogo
          if (roomData.status === 'playing') {
            const gameState = roomData.gameState;
            const currentPlayer = roomData.players.find(p => p.id === userId);
            
            if (currentPlayer) {
              // Atualizar pontua√ß√£o
              if (currentPlayer.isHost) {
                player1Score = currentPlayer.score;
              } else {
                player2Score = currentPlayer.score;
              }
              
              // Atualizar dicas e pulos
              hintsAvailable = currentPlayer.hintsAvailable;
              skipsAvailable = currentPlayer.skipsAvailable;
              
              // Atualizar interface
              updateScore();
              updateDuetoDisplay();
              
              // Atualizar timer
              if (gameState.timeLeft !== timeLeft) {
                timeLeft = gameState.timeLeft;
                document.getElementById('timer').textContent = `Tempo: ${timeLeft}s`;
              }

              // Atualizar quest√£o atual
              if (gameState.currentQuestion !== current) {
                current = gameState.currentQuestion;
                showQuestion();
              }
            }
          }
        });

      } catch (error) {
        console.error("Erro ao criar sala:", error);
        alert("Erro ao criar sala. Tente novamente.");
      }
    }

    async function joinWebMultiplayer() {
      const code = document.getElementById('roomCodeInput').value.trim().toUpperCase();
      if (!code || code.length !== 6) {
        alert("Por favor, digite um c√≥digo v√°lido de 6 caracteres!");
        return;
      }

      try {
        const roomRef = doc(db, "rooms", code);
        const roomDoc = await getDoc(roomRef);
        
        if (!roomDoc.exists()) {
          alert("Sala n√£o encontrada!");
          return;
        }

        const roomData = roomDoc.data();
        if (roomData.status !== 'waiting') {
          alert("Esta sala j√° est√° em jogo!");
          return;
        }

        // Entrar na sala
        await updateDoc(roomRef, {
          players: arrayUnion({
            id: userId,
            name: player1Name,
            isHost: false,
            score: 0,
            hintsAvailable: 3,
            skipsAvailable: 0
          })
        });

        // Configurar listener para mudan√ßas na sala
        onSnapshot(roomRef, (doc) => {
          const roomData = doc.data();
          if (!roomData) return;

          if (roomData.status === 'playing') {
            startMultiplayerGame(roomData);
          }
        });

      } catch (error) {
        console.error("Erro ao entrar na sala:", error);
        alert("Erro ao entrar na sala. Tente novamente.");
      }
    }

    function copyRoomCode() {
      const code = document.getElementById('roomCode').textContent;
      navigator.clipboard.writeText(code).then(() => {
        const copyBtn = document.getElementById('copyCodeBtn');
        copyBtn.innerHTML = '<span>‚úì</span> Copiado!';
        setTimeout(() => {
          copyBtn.innerHTML = '<span>üìã</span> Copiar C√≥digo';
        }, 2000);
      });
    }

    function startMultiplayerGame(roomData) {
      gameMode = 'multiplayer';
      document.getElementById('multiplayerBtns').style.display = 'none';
      document.getElementById('mainGameArea').style.display = 'block';
      document.getElementById('duetoInfo').style.display = 'block';
      
      // Configurar nomes dos jogadores
      const host = roomData.players.find(p => p.isHost);
      const guest = roomData.players.find(p => !p.isHost);
      
      player1Name = host.name;
      player2Name = guest.name;
      
      document.getElementById('player1NameDisplay').textContent = player1Name;
      document.getElementById('player2NameDisplay').textContent = player2Name;
      
      restartGame();
      startTimer();
    }

    // Fun√ß√£o para atualizar o estado do jogo no Firebase
    async function updateGameState(updates) {
      try {
        const roomRef = doc(db, "rooms", roomCode);
        const roomDoc = await getDoc(roomRef);
        
        if (!roomDoc.exists()) return;
        
        const roomData = roomDoc.data();
        const currentPlayer = roomData.players.find(p => p.id === userId);
        
        if (currentPlayer) {
          const playerUpdates = {
            score: currentPlayer.isHost ? player1Score : player2Score,
            hintsAvailable: hintsAvailable,
            skipsAvailable: skipsAvailable
          };
          
          await updateDoc(roomRef, {
            [`players.${roomData.players.indexOf(currentPlayer)}`]: playerUpdates,
            'gameState': {
              ...roomData.gameState,
              ...updates
            }
          });
        }
      } catch (error) {
        console.error("Erro ao atualizar estado do jogo:", error);
      }
    }

    // Event Listeners para os bot√µes
    document.addEventListener('DOMContentLoaded', () => {
      // Tentar carregar o estado do jogo
      loadGameState();

      // Verificar conex√£o
      checkConnection();

      // Adicionar event listeners aos bot√µes
      document.getElementById('submitBtn').addEventListener('click', checkAnswer);
      document.getElementById('restartBtn').addEventListener('click', restartGame);
      document.getElementById('giveUpBtn').addEventListener('click', giveUp);
      document.getElementById('noSenseBtn').addEventListener('click', noSense);
      document.getElementById('secondChanceBtn').addEventListener('click', secondChance);
      document.getElementById('skipBtn').addEventListener('click', skipQuestion);
      document.getElementById('hintBtn').addEventListener('click', showHint);
      document.getElementById('easyBtn').addEventListener('click', () => setDifficulty('easy'));
      document.getElementById('mediumBtn').addEventListener('click', () => setDifficulty('medium'));
      document.getElementById('hardBtn').addEventListener('click', () => setDifficulty('hard'));
      document.getElementById('multiplayerBtn').addEventListener('click', showMultiplayerOptions);
      document.getElementById('webMultiplayerBtn').addEventListener('click', showWebMultiplayerOptions);
      document.getElementById('createRoomBtn').addEventListener('click', showCreateRoom);
      document.getElementById('enterRoomBtn').addEventListener('click', showJoinRoom);
      document.getElementById('joinRoomBtn').addEventListener('click', joinWebMultiplayer);
      document.getElementById('copyCodeBtn').addEventListener('click', copyRoomCode);
      document.getElementById('backToOptionsBtn').addEventListener('click', showMultiplayerOptions);
      document.getElementById('startGameBtn').addEventListener('click', async () => {
        const roomRef = doc(db, "rooms", roomCode);
        await updateDoc(roomRef, {
          status: 'playing',
          'gameState.currentQuestion': 0
        });
      });
      
      // Implementar Bluetooth e Local Network quando necess√°rio
      document.getElementById('bluetoothMultiplayerBtn').addEventListener('click', () => {
        alert("Funcionalidade Bluetooth em desenvolvimento!");
      });
      
      document.getElementById('localMultiplayerBtn').addEventListener('click', () => {
        alert("Funcionalidade Local Network em desenvolvimento!");
      });
    });

    // Adicionar ouvinte para salvar o estado antes de fechar a p√°gina
    window.addEventListener('beforeunload', saveGameState);
  </script>
</body>
</html>
